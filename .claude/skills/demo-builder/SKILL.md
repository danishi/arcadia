---
name: demo-builder
description: "デモアプリ仕様書に基づき、Next.jsデモアプリに画面を追加・更新するスキル。"
user-invocable: true
argument-hint: "<画面名またはall> [パターン: dashboard|chat|builder]"
allowed-tools: Read, Grep, Glob, Write, Edit, Bash
---

# デモアプリビルダー

## 概要

本スキルは、デモアプリ仕様書（`demo-app-spec.md`）に基づき、Next.js App Router構成のデモアプリに画面を追加・更新する。
3つの画面パターン（Dashboard型/Chat型/Builder型）から適切なテンプレートを選択し、効率的に画面を構築する。

---

## 画面追加手順（5ステップ）

### Step 1: デモアプリ仕様書から画面定義を読込

プロジェクトルートの `demo-app-spec.md` を読み込み、以下を把握する:

- **画面一覧**: 全画面の名称、パス、概要
- **画面ごとの要件**: 表示項目、操作、データソース
- **フェーズ分類**: どのフェーズに属する画面か（必須/オプション）
- **技術スタック**: 使用するライブラリ、フレームワーク
- **サンプルデータ**: 各画面で使用するデータテーブル

### Step 2: 画面パターン選定

画面の性質に応じて、3つのパターンから最適なものを選定する:

#### Dashboard型
- **適合する画面**: データ連携一覧、監視ダッシュボード、KPI表示、パイプライン可視化
- **構成要素**:
  - KPIタイルエリア（上部）: 主要指標のカード表示
  - メインビジュアライゼーション（中央）: パイプライン図、フロー図、グラフ
  - データテーブル（下部）: 詳細データの一覧表示
  - フィルタ/期間セレクタ（サイド/上部）
- **推奨ライブラリ**: Recharts（グラフ）、Framer Motion（アニメーション）

#### Chat型
- **適合する画面**: AI分析、自然言語クエリ、チャットボット、レポート生成
- **構成要素**:
  - チャットメッセージエリア（左/中央）: ユーザー入力とAI応答の表示
  - 入力フォーム（下部）: テキスト入力、送信ボタン、サジェスト
  - 結果表示パネル（右/下部）: テーブル、グラフ、サマリ
  - コンテキストパネル（サイド）: 利用可能テーブル、クエリ履歴
- **推奨ライブラリ**: ストリーミング対応のfetch、Recharts（結果グラフ）

#### Builder型
- **適合する画面**: ジャーニービルダー、ワークフロー編集、シナリオ設計
- **構成要素**:
  - キャンバスエリア（中央）: ノード/エッジのドラッグ&ドロップ編集
  - ノードパレット（左サイド）: 追加可能なノード種別一覧
  - プロパティパネル（右サイド）: 選択ノードの設定編集
  - ツールバー（上部）: 保存、実行、ズーム等のアクション
- **推奨ライブラリ**: Framer Motion（ドラッグ）、カスタムキャンバス実装

### Step 3: テンプレートからの画面構築

`_screen-templates/` ディレクトリにテンプレートが存在する場合はそれをベースにカスタマイズする。
テンプレートが存在しない場合は、Step 2のパターン定義に従って新規作成する。

#### ファイル構成（1画面あたり）

```
src/app/[画面パス]/
  page.tsx              # ページコンポーネント（メインレイアウト）

src/components/[画面名]/
  [画面名]-header.tsx   # 画面ヘッダー（タイトル、フィルタ等）
  [画面名]-main.tsx     # メインコンテンツ（パターンに応じた中央エリア）
  [画面名]-panel.tsx    # サイドパネル/詳細パネル（該当する場合）
  types.ts              # 画面固有の型定義
```

#### 実装時の共通規約

- UIテキストは仕様書が指定する言語で記述する（日本語指定が多い）
- `"use client"` ディレクティブはインタラクティブなコンポーネントにのみ付与
- API呼び出しは `src/app/api/` 配下にRoute Handlerを作成
- エラーメッセージは仕様書指定の言語で表示
- レスポンシブ対応: モバイルビューは最低限の確認（デモ用途のためデスクトップ優先）

### Step 4: ナビゲーション追加

サイドバー（`src/components/sidebar.tsx` 等）にナビゲーション項目を追加する:

```typescript
// ナビゲーション項目の追加例
{
  name: "[画面名]",
  path: "/[画面パス]",
  icon: [適切なアイコン],
}
```

- 画面のフェーズ分類に応じてグループ分けする
- アイコンは画面の機能を直感的に表すものを選択する

### Step 5: モックデータ追加

`src/lib/mock-data.ts`（または各画面のデータファイル）にモックデータを追加する:

- 仕様書のサンプルデータ定義に準拠する
- データ量はデモに適切な件数（10-50件程度）にする
- 日付データは相対日付（`new Date()` ベース）で生成し、デモ時に古くならないようにする
- 金額・数値データはリアリティのある値にする

---

## プラットフォーム未接続時のフォールバック確認

デモアプリがバックエンドプラットフォーム（DWH、AI基盤等）と接続できない状態でも動作することを確認する:

### 確認チェックリスト

- [ ] API Route内で接続エラー時にモックデータを返すフォールバックが実装されている
- [ ] 環境変数が未設定の場合に適切なデフォルト動作をする
- [ ] 接続状態をUIに表示する仕組みがある（「デモモード」バッジ等）
- [ ] チャット型画面のAI応答が、未接続時にもサンプル応答を返す
- [ ] グラフ/テーブルがモックデータで正常に描画される
- [ ] エラー画面ではなく、機能制限付きで正常動作する

### フォールバック実装パターン

```typescript
// API Route内のフォールバックパターン例
export async function GET() {
  try {
    // プラットフォームAPIへの接続を試行
    const data = await platformClient.query(...)
    return NextResponse.json(data)
  } catch (error) {
    // 接続失敗時はモックデータを返却
    console.warn("Platform not connected, using mock data")
    return NextResponse.json(mockData)
  }
}
```

---

## 引数の説明

### 画面名

- 個別の画面名を指定: `dashboard`, `analysis`, `scenario` 等
- `all` を指定: 仕様書に定義された全画面を順次作成/更新

### パターン

- `dashboard`: Dashboard型パターンで画面を構築
- `chat`: Chat型パターンで画面を構築
- `builder`: Builder型パターンで画面を構築
- 省略時: 仕様書の画面定義から自動判定

---

## 注意事項

- 画面追加前に必ず `demo-app-spec.md` の最新版を確認すること
- 既存画面の更新時は、現在の実装を `Read` で確認してから差分変更すること
- 新しいnpmパッケージが必要な場合は、追加前にユーザーに確認すること
- パフォーマンス: 大量データのレンダリングには仮想スクロールやページネーションを検討する
- アクセシビリティ: デモ用途でも最低限のaria-label付与を推奨する
