# ARCADIA Data Platform Templates

Medallion Architecture (Bronze / Silver / Gold) をベースとした、プラットフォーム非依存のデータ基盤テンプレート集。

## Medallion Architecture

```
Raw Files (CSV/JSON)
    |
    v
+------------------+    +------------------+    +------------------+
|   Bronze Layer   | -> |   Silver Layer   | -> |   Gold Layer     |
|  (Raw Ingestion) |    |  (Cleansed)      |    |  (Aggregated)    |
+------------------+    +------------------+    +------------------+
  - As-is取込            - 型変換              - ビジネスロジック
  - スキーマ推論          - 重複排除            - KPI集計
  - 増分対応              - NULLハンドリング     - 統合ビュー
```

## プラットフォーム対応表

| 機能カテゴリ | Databricks | Snowflake | BigQuery |
|-------------|-----------|-----------|----------|
| **カタログ管理** | Unity Catalog | Snowflake Database | BigQuery Dataset |
| **ストレージ** | Unity Catalog Volume | Stage (Internal/External) | Cloud Storage (GCS) |
| **テーブル形式** | Delta Lake | Iceberg / Native | BigQuery Native |
| **ETL / 取込** | Auto Loader / COPY INTO | Snowpipe / COPY INTO | Dataform / LOAD DATA |
| **増分処理** | Delta Live Tables (DLT) | Streams + Tasks | Scheduled Queries |
| **SQL Warehouse** | Serverless SQL Warehouse | Virtual Warehouse | On-demand / Slot |
| **AI / ML** | Mosaic AI / MLflow | Snowpark ML / Cortex | Vertex AI / BQML |
| **自然言語分析** | Genie Space | Cortex Analyst | Gemini in BigQuery |
| **ダッシュボード** | AI/BI Dashboard | Streamlit in Snowflake | Looker / Connected Sheets |
| **ガバナンス** | Unity Catalog ACL | RBAC / DAC | IAM / Column-level Security |
| **コスト管理** | DBU (Serverless) | Credit (Warehouse) | Slot / On-demand |

## 共通テーブル定義

全プラットフォーム共通で以下5テーブルを使用する。

| テーブル | 説明 | Bronze | Silver | Gold |
|---------|------|--------|--------|------|
| customers | 顧客マスタ | raw_customers | customers | customer_360 |
| accounts | 口座マスタ | raw_accounts | accounts | - |
| transactions | 取引履歴 | raw_transactions | transactions | daily_summary |
| campaigns | キャンペーン | raw_campaigns | campaigns | campaign_effectiveness |
| campaign_responses | キャンペーン反応 | raw_campaign_responses | campaign_responses | - |
| web_events | Web行動ログ | raw_web_events | web_events | - |

## 使い方

### 1. 共通データ生成

```bash
cd common/
# テンプレートをコピーして設定を編集
cp 00_config.py.tmpl 00_config.py
# PROJECT_SLUG, PLATFORM_TYPE を設定

# サンプルデータを生成（CSV/JSON出力）
python 02_generate_sample_data.py
```

### 2. プラットフォーム固有スクリプトの実行

選択したプラットフォームのフォルダに移動し、手順に従う。

- **Databricks**: `databricks/README.md` を参照
- **Snowflake**: `snowflake/README.md` を参照 (stub)
- **BigQuery**: `bigquery/README.md` を参照 (stub)

### 3. オーケストレーション

```bash
python common/07_run_all.py
```

プラットフォーム判定に基づき、対応するスクリプトを自動的に順次実行する。

## ディレクトリ構成

```
platform/data/
  README.md                              # 本ファイル
  common/
    00_config.py.tmpl                    # 共通設定テンプレート
    02_generate_sample_data.py.tmpl      # サンプルデータ生成（プラットフォーム非依存）
    07_run_all.py.tmpl                   # オーケストレーション
  databricks/
    README.md                            # Databricks固有手順
    01_setup_infrastructure.py.tmpl      # Unity Catalog / Schema / Volume 作成
    03_bronze_ingestion.py.tmpl          # CSV/JSON -> Bronze取込
    04_silver_transform.py.tmpl          # Bronze -> Silver変換
    05_gold_aggregate.py.tmpl            # Silver -> Gold集約
    06_setup_analytics.py.tmpl           # SQL Warehouse / Genie / Dashboard準備
  snowflake/
    README.md                            # Snowflake対応ガイド (stub)
  bigquery/
    README.md                            # BigQuery対応ガイド (stub)
```

## カスタマイズ

テンプレートファイル (`.py.tmpl`) 内の `{{PLACEHOLDER}}` を自プロジェクトの値に置き換えて使用する。

| プレースホルダ | 説明 | 例 |
|---------------|------|-----|
| `{{PROJECT_SLUG}}` | プロジェクト識別子（英数字+アンダースコア） | `my_bank` |
| `{{PLATFORM_TYPE}}` | 対象プラットフォーム | `databricks` |
| `{{CATALOG_LOCATION}}` | Databricks: カタログのストレージパス | `s3://bucket/path` |

---

*Generated by ARCADIA Framework - Platform Templates*
